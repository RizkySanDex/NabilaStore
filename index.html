<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nabila Store</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    font-family:"Segoe UI",Arial,sans-serif;
    background:#f7f7f7;
    color:#222;
}

.container{width:94%;max-width:1150px;margin:20px auto}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.logo{display:flex;align-items:center;gap:8px}
.logo i{font-size:1.6rem;color:#ff5314}
.logo h1{font-size:1.1rem;font-weight:700}

.search-bar{flex:1;display:flex;max-width:520px;margin-left:12px}
.search-bar input{
    flex:1;padding:9px 12px;border:1px solid #ddd;border-radius:6px 0 0 6px
}
.search-bar button{
    background:#2a2a2a;color:white;padding:0 14px;border-radius:0 6px 6px 0;
}

.nav-links a{margin-left:12px;color:#777;text-decoration:none;font-size:.9rem}

.filters{display:flex;gap:8px;margin:14px 0}
.filter-btn{
    padding:8px 14px;border:1px solid #eee;border-radius:20px;background:#fff;
    cursor:pointer;color:#666;font-weight:600;font-size:0.87rem
}
.filter-btn.active{background:#ff5314;color:#fff;border-color:#ff5314}

.video-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
    gap:18px;
}
.video-card{
    background:white;
    border-radius:12px;
    box-shadow:0 6px 20px rgba(0,0,0,0.06);
    overflow:hidden;
    transition:.2s;
}
.video-card:hover{transform:translateY(-6px)}

.video-thumb{
    position:relative;
    width:100%;
    aspect-ratio:1/1;
    background:#f3f3f3;
}
.video-thumb img{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
}
.video-duration{
    position:absolute;right:8px;bottom:8px;background:rgba(0,0,0,.6);
    color:white;padding:3px 7px;font-size:12px;border-radius:6px
}

.video-info{padding:12px}
.video-info h3{
    height:32px;
    font-size:0.78rem;
    font-weight:400;
    overflow:hidden;
    margin-bottom:4px;
    line-height:1.25;
}
.video-meta{
    display:flex;justify-content:space-between;font-size:0.85rem;color:#777;
    margin-bottom:10px
}
.video-actions{display:flex;gap:8px}
.watch-btn,.buy-btn{
    flex:1;
    text-align:center;
    padding:6px 0;
    font-size:0.75rem;
    border-radius:5px;
    text-decoration:none;
    font-weight:500;
    color:white;
}
.watch-btn{background:#ff5314}
.buy-btn{background:#2a2a2a}

.modal{
    position:fixed;inset:0;
    background:rgba(0,0,0,.65);
    display:none;align-items:center;justify-content:center;
    padding:20px;z-index:1500;
}
.modal.open{display:flex}

.modal-box{
    background:white;width:100%;max-width:1180px;
    border-radius:12px;overflow:hidden;
    position:relative;box-shadow:0 20px 60px rgba(0,0,0,.35);
}

.modal-close{
    position:absolute;top:16px;right:16px;
    width:40px;height:40px;border-radius:50%;
    background:rgba(0,0,0,.45);color:white;
    font-size:20px;display:flex;align-items:center;justify-content:center;
    cursor:pointer;border:none;z-index:10;
}

.modal-content-row{
    display:flex;
    gap:6px;        /* FIX SUPER RAPAT */
    padding:10px;   /* FIX SUPER RAPAT */
}
.modal-left{flex:2}
.modal-right{flex:1;display:grid;gap:6px}

.modal-video-wrap{
    position:relative;width:100%;aspect-ratio:16/9;background:black;
}
.modal-video-wrap iframe,
.modal-video-wrap video{
    position:absolute;inset:0;width:100%;height:100%;object-fit:contain;border:0;
}

/* POSTER GRID RAPAT 100% */
.image-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,95px);
    grid-auto-rows:95px;
    gap:6px;
    justify-content:start;
}
.image-grid img{
    width:95px;height:95px;
    object-fit:cover;
    border-radius:8px;
    cursor:pointer;
    border:1px solid #eee;
    background:#f3f3f3;
}

.modal-details{
    padding:10px 16px 14px;
    border-top:1px solid #eee;
    margin-top:-4px;
}
.modal-details h3{font-size:1.1rem;margin-bottom:4px}
.modal-details p{color:#555;font-size:0.9rem;margin-bottom:6px;line-height:1.32}
.product-link{
    display:inline-block;padding:10px 16px;background:#ff5314;
    color:white;border-radius:8px;font-weight:700;text-decoration:none;margin-top:4px
}

.img-viewer{
    position:fixed;inset:0;background:rgba(0,0,0,.85);
    display:none;align-items:center;justify-content:center;
    z-index:3000;
}
.img-viewer.open{display:flex}

.img-viewer img{
    max-width:90%;max-height:90%;border-radius:10px;object-fit:contain;
}

.img-viewer-btn{
    position:absolute;top:50%;transform:translateY(-50%);
    background:rgba(0,0,0,.6);color:white;
    width:50px;height:50px;border-radius:50%;
    display:flex;align-items:center;justify-content:center;
    font-size:28px;border:none;cursor:pointer;
}
.img-prev{left:20px}
.img-next{right:20px}

.img-viewer-close{
    position:absolute;top:20px;right:20px;
    width:45px;height:45px;border-radius:50%;
    font-size:28px;background:rgba(0,0,0,.6);color:white;border:none;cursor:pointer
}

@media(max-width:768px){
    .modal-content-row{flex-direction:column}
}
</style>
</head>

<body>
<div class="container">
    <header>
        <div style="display:flex;align-items:center;gap:10px;">
            <div class="logo"><i class="fas fa-play-circle"></i><h1>Nabila Store</h1></div>
            <div class="search-bar">
                <input id="searchInput" type="text" placeholder="Cari video...">
                <button><i class="fas fa-search"></i></button>
            </div>
        </div>
        <nav class="nav-links">
            <a>Beranda</a>
            <a>Kategori</a>
        </nav>
    </header>

    <div class="filters">
    <button class="filter-btn active">Semua</button>
    <button class="filter-btn">Pakaian Pria</button>
	<button class="filter-btn">Pakaian Wanita</button>
    <button class="filter-btn">Elektronik</button>
    <button class="filter-btn">Kecantikan</button>
    <button class="filter-btn">Rumah Tangga</button>
    <button class="filter-btn">Gaming</button>
    <button class="filter-btn">Aksesoris HP</button>
    <button class="filter-btn">Dapur</button>
</div>

    <div id="videoContainer" class="video-grid"></div>
</div>

<!-- MODAL -->
<div id="videoModal" class="modal">
    <div class="modal-box" id="modalBox">
        <button class="modal-close" id="closeModal">&times;</button>

        <div class="modal-content-row">
            <div class="modal-left">
                <div class="modal-video-wrap" id="modalVideo"></div>
            </div>
            <div class="modal-right">
                <div class="image-grid" id="imageGallery"></div>
            </div>
        </div>

        <div class="modal-details">
            <h3 id="modalTitle"></h3>
            <p id="modalDescription"></p>
            <a id="modalProductLink" class="product-link" target="_blank">Lihat Produk</a>
        </div>
    </div>
</div>

<!-- IMAGE VIEWER -->
<div class="img-viewer" id="imgViewer">
    <button class="img-viewer-btn img-prev" id="imgPrev">&#10094;</button>
    <img id="imgViewerImg" src="">
    <button class="img-viewer-btn img-next" id="imgNext">&#10095;</button>
    <button class="img-viewer-close" id="imgViewerClose">&times;</button>
</div>

<script>
const BLOG_ID = "5725416963670414367";
const API_KEY = "AIzaSyA8k0Fr9m-7zsC1EzdOjI3kgMR92bJHs_E";

const videoContainer = document.getElementById("videoContainer");
let currentVideos = [];
function parseHTML(post){
    return new DOMParser().parseFromString(post.content || "", "text/html");
}

function extractThumbnail(p){
    const doc = parseHTML(p);
    return doc.querySelector(".thumbnail")?.textContent?.trim() ||
           doc.querySelector("img")?.src ||
           "https://via.placeholder.com/600x800?text=No+Image";
}
function extractVideoUrl(p){
    const doc = parseHTML(p);
    return doc.querySelector(".video_url")?.textContent?.trim() ||
           doc.querySelector("iframe")?.src || "";
}
function extractDescription(p){
    const doc = parseHTML(p);
    return doc.querySelector(".video-description")?.textContent?.trim() || "";
}
function extractProductLink(p){
    const doc = parseHTML(p);
    return doc.querySelector(".product_link")?.textContent?.trim() ||
           doc.querySelector("a[href*='shopee']")?.href || "#";
}
function extractGallery(p){
    const doc = parseHTML(p);
    const raw = doc.querySelector(".gallery")?.textContent?.trim();
    if(!raw) return [];
    return raw.split(",").map(x=>x.trim()).filter(x=>x.length>5);
}

// NEW: extractPrice function
function extractPrice(p){
    try{
        const doc = parseHTML(p);
        return doc.querySelector('.product_price')?.textContent?.trim() || "-";
    }catch(e){
        return "-";
    }
}

async function loadVideos(){
    const url = `https://www.googleapis.com/blogger/v3/blogs/${BLOG_ID}/posts?key=${API_KEY}&maxResults=30`;
    const res = await fetch(url);
    const data = await res.json();

    currentVideos = data.items.map(p=>({
        id:p.id,
        title:p.title,
        thumbnail:extractThumbnail(p),
        videoUrl:extractVideoUrl(p),
        productLink:extractProductLink(p),
        description:extractDescription(p),
        gallery:extractGallery(p),
        price: extractPrice(p),
        labels: p.labels || []
    }));

    renderList(currentVideos);

    initFilters();
}

function renderList(list){
    videoContainer.innerHTML = "";
    list.forEach(v=>{
        const card = document.createElement("div");
        card.className = "video-card";
        card.innerHTML = `
            <div class="video-thumb">
                <img src="${v.thumbnail}">
                <div class="video-duration">Video</div>
            </div>
            <div class="video-info">
                <h3>${v.title}</h3>
                <div class="video-meta"><span>${v.price || 'Harga'}</span></div>
                <div class="video-actions">
                    <a href="#" class="watch-btn" data-id="${v.id}">Tonton</a>
                    <a class="buy-btn" href="${v.productLink}" target="_blank">Beli</a>
                </div>
            </div>`;

        card.querySelector(".watch-btn").onclick = e=>{
            e.preventDefault();
            openModal(v.id);
        };
        videoContainer.appendChild(card);
    });
}

function openModal(id){
    const v = currentVideos.find(x=>x.id===id);
    if(!v) return;

    document.getElementById("modalTitle").textContent = v.title;
    document.getElementById("modalDescription").textContent = v.description;
    document.getElementById("modalProductLink").href = v.productLink;
    document.getElementById("modalVideo").innerHTML = `<iframe src="${v.videoUrl}?autoplay=1" allowfullscreen></iframe>`;

    const grid = document.getElementById("imageGallery");
    grid.innerHTML = "";
    v.gallery.forEach((src,i)=>{
        const img = document.createElement("img");
        img.src = src;
        img.onclick = ()=>openImageViewer(i,v.gallery);
        grid.appendChild(img);
    });

    document.getElementById("videoModal").classList.add("open");
}

document.getElementById("closeModal").onclick = ()=>{
    document.getElementById("videoModal").classList.remove("open");
    document.getElementById("modalVideo").innerHTML="";
};

let currentGallery=[];
let currentIndex=0;

function openImageViewer(i,gallery){
    currentGallery = gallery;
    currentIndex = i;
    document.getElementById("imgViewerImg").src = gallery[i];
    document.getElementById("imgViewer").classList.add("open");
}

document.getElementById("imgPrev").onclick = ()=>{
    if(!currentGallery.length) return;
    currentIndex = (currentIndex - 1 + currentGallery.length) % currentGallery.length;
    document.getElementById("imgViewerImg").src = currentGallery[currentIndex];
};

document.getElementById("imgNext").onclick = ()=>{
    if(!currentGallery.length) return;
    currentIndex = (currentIndex + 1) % currentGallery.length;
    document.getElementById("imgViewerImg").src = currentGallery[currentIndex];
};

document.getElementById("imgViewerClose").onclick = ()=>{
    document.getElementById("imgViewer").classList.remove("open");
};

loadVideos();
function initFilters(){
    document.querySelectorAll('.filter-btn').forEach(btn=>{
        btn.onclick = ()=>{
            document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');

            const label = btn.textContent.trim().toLowerCase();

            if(label === "semua"){
                renderList(currentVideos);
            } else {
                const filtered = currentVideos.filter(v =>
                    (v.labels || []).map(x=>x.toLowerCase()).includes(label)
                );
                renderList(filtered);
            }
        };
    });
}

</script>
</body>
</html>
